<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TriggerSpring - Pull to Refresh Example</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
        }

        .scroll-container {
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Loading indicator - HIDDEN above the visible area */
        .loading-trigger {
            height: 100px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            gap: 12px;
        }

        .loading-icon {
            font-size: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-trigger.active {
            background: #28a745;
        }

        .loading-trigger.active .loading-icon {
            animation: none;
        }

        /* Page content */
        .page-content {
            background: white;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }

        header h1 {
            font-size: 42px;
            margin-bottom: 12px;
        }

        header p {
            font-size: 18px;
            opacity: 0.9;
        }

        .instruction {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 24px;
            margin: 30px 40px;
            border-radius: 8px;
            color: #856404;
        }

        .instruction h3 {
            margin-bottom: 12px;
            color: #664d03;
            font-size: 18px;
        }

        .instruction ol {
            margin-left: 20px;
        }

        .instruction li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .instruction strong {
            color: #664d03;
        }

        .content {
            padding: 40px;
        }

        .article {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .article h2 {
            color: #333;
            margin-bottom: 16px;
            font-size: 26px;
        }

        .article p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 16px;
        }

        .article .meta {
            color: #999;
            font-size: 14px;
        }

        .new-article {
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Status indicator */
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-weight: 600;
            z-index: 1000;
            font-size: 14px;
        }

        /* Controls */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            width: 280px;
            z-index: 1000;
        }

        .controls h3 {
            margin-bottom: 16px;
            font-size: 16px;
            color: #333;
        }

        .control-group {
            margin-bottom: 14px;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #555;
            margin-bottom: 6px;
        }

        .control-group input,
        .control-group select {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
        }

        .value-display {
            font-size: 11px;
            color: #667eea;
            margin-top: 4px;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 3px solid #2196f3;
            padding: 12px;
            border-radius: 4px;
            margin-top: 14px;
        }

        .info-box p {
            font-size: 11px;
            color: #555;
            line-height: 1.5;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="scroll-container" id="scroll-container">
        <!-- This loading trigger is ABOVE the content, initially scrolled out of view -->
        <div class="loading-trigger" id="loading-trigger">
            <span class="loading-icon">üîÑ</span>
            <span id="loading-text">Pull down to refresh</span>
        </div>

        <div class="page-content">
            <header>
                <h1>üîÑ Pull to Refresh</h1>
                <p>Desktop web with mobile-style refresh behavior</p>
            </header>

            <div class="instruction">
                <h3>üìñ How to Use:</h3>
                <ol>
                    <li>
                        <strong>Scroll to the very top</strong> of this page until you can't scroll up anymore
                    </li>
                    <li>
                        <strong>Keep trying to scroll UP</strong> - you'll start revealing the purple loading indicator above
                    </li>
                    <li>
                        <strong>Pull it partially visible, then release</strong>
                    </li>
                    <li>
                        <strong>Watch TriggerSpring decide:</strong>
                        <ul style="margin-top: 8px; margin-left: 20px;">
                            <li>If you pulled enough (>50% visible) ‚Üí Triggers refresh and shows it fully</li>
                            <li>If you didn't pull enough ‚Üí Snaps back to hide it</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="content" id="content">
                <div class="article">
                    <h2>Understanding TriggerSpring</h2>
                    <p>
                        TriggerSpring is designed to keep elements hidden outside the scroll area and 
                        automatically snap them back when they become partially visible.
                    </p>
                    <p>
                        In this example, the loading indicator is positioned ABOVE the page content. 
                        It starts hidden (scroll is positioned to hide it). When you overscroll upward, 
                        you reveal it partially. TriggerSpring then decides: hide it again or show it fully?
                    </p>
                    <div class="meta">Posted 2 minutes ago</div>
                </div>

                <div class="article">
                    <h2>The Key Concept</h2>
                    <p>
                        <strong>The trigger element should NOT be visible by default.</strong> It sits outside 
                        the viewport, and TriggerSpring's job is to keep it that way unless you intentionally 
                        pull it into view.
                    </p>
                    <p>
                        When scrolling stops with the element partially visible (intersection ratio between 0 and 1), 
                        TriggerSpring waits a moment, then makes a decision:
                    </p>
                    <ul style="margin-left: 20px; color: #666; margin-bottom: 16px;">
                        <li>Snap it fully hidden (scroll back to hide it)</li>
                        <li>Snap it fully visible (scroll to reveal it completely and trigger callback)</li>
                    </ul>
                    <div class="meta">Posted 5 minutes ago</div>
                </div>

                <div class="article">
                    <h2>Perfect for Pull-to-Refresh</h2>
                    <p>
                        This behavior is perfect for implementing pull-to-refresh on desktop:
                    </p>
                    <ul style="margin-left: 20px; color: #666; margin-bottom: 16px;">
                        <li>Loading indicator stays hidden above the page</li>
                        <li>User overscrolls upward to reveal it</li>
                        <li>If they pull far enough, it triggers the refresh</li>
                        <li>If they don't pull enough, it snaps back to hidden</li>
                    </ul>
                    <p>
                        This creates the familiar mobile refresh experience on desktop browsers!
                    </p>
                    <div class="meta">Posted 10 minutes ago</div>
                </div>
            </div>
        </div>
    </div>

    <div class="status" id="status">Scroll to top and pull down</div>

    <div class="controls">
        <h3>‚öôÔ∏è Settings</h3>
        
        <div class="control-group">
            <label>Direction:</label>
            <select id="direction-select">
                <option value="left" selected>Left</option>
                <option value="right">Right</option>
            </select>
        </div>

        <div class="control-group">
            <label>Delay (ms):</label>
            <input type="range" id="delay-slider" min="100" max="1500" value="500" step="50">
            <div class="value-display" id="delay-value">500ms</div>
        </div>

        <div class="control-group">
            <label>Offset (px):</label>
            <input type="range" id="offset-slider" min="-100" max="300" value="0" step="25">
            <div class="value-display" id="offset-value">0px</div>
        </div>

        <div class="info-box">
            <p>
                <strong>Tip:</strong> The loading indicator starts hidden. Scroll to top and pull up to reveal it!
            </p>
        </div>
    </div>

    <script type="module">
        import TriggerSpring from '../TriggerSpring/index.js'

        const scrollContainer = document.getElementById('scroll-container')
        const loadingTrigger = document.getElementById('loading-trigger')
        const loadingText = document.getElementById('loading-text')
        const content = document.getElementById('content')
        const status = document.getElementById('status')
        const directionSelect = document.getElementById('direction-select')
        const delaySlider = document.getElementById('delay-slider')
        const offsetSlider = document.getElementById('offset-slider')
        const delayValue = document.getElementById('delay-value')
        const offsetValue = document.getElementById('offset-value')

        let isRefreshing = false
        let articleCount = 0

        // Position scroll to HIDE the loading trigger initially
        scrollContainer.scrollTop = loadingTrigger.offsetHeight

        function initSpring() {
            const direction = directionSelect.value
            const delay = parseInt(delaySlider.value)
            const offset = parseInt(offsetSlider.value)

            new TriggerSpring({
                container: scrollContainer,
                trigger: loadingTrigger,
                target: loadingTrigger,
                direction: direction,
                offset: offset,
                delay: delay,
                callback: () => {
                    // Callback fires when trigger is FULLY visible = trigger refresh!
                    triggerRefresh()
                }
            })
        }

        // Monitor when trigger is partially visible and user stops scrolling
        // to snap back to hidden if they didn't pull enough
        let snapTimeout
        scrollContainer.addEventListener('scroll', () => {
            if (isRefreshing) return

            clearTimeout(snapTimeout)

            const scrollTop = scrollContainer.scrollTop
            const triggerHeight = loadingTrigger.offsetHeight

            // If loading indicator is partially visible (between 0 and fully hidden)
            if (scrollTop > 0 && scrollTop < triggerHeight) {
                snapTimeout = setTimeout(() => {
                    // If still partially visible after scroll stops, snap back to hide it
                    // (TriggerSpring will handle showing it fully if pulled enough via callback)
                    if (scrollContainer.scrollTop > 0 && scrollContainer.scrollTop < triggerHeight) {
                        scrollContainer.scrollTo({
                            top: triggerHeight,
                            behavior: 'smooth'
                        })
                        status.textContent = 'Snapped back (not pulled enough)'
                        status.style.color = '#dc3545'
                        
                        setTimeout(() => {
                            status.textContent = 'Scroll to top and pull down'
                            status.style.color = '#333'
                        }, 1500)
                    }
                }, parseInt(delaySlider.value))
            }
        })

        function triggerRefresh() {
            if (isRefreshing) return

            isRefreshing = true
            status.textContent = 'üîÑ Refreshing...'
            status.style.color = '#667eea'
            loadingTrigger.classList.add('active')
            loadingText.textContent = 'Refreshing content...'

            // Simulate loading new content
            setTimeout(() => {
                articleCount++
                
                // Add new article at the top
                const newArticle = document.createElement('div')
                newArticle.className = 'article new-article'
                newArticle.innerHTML = `
                    <h2>‚ú® New Article ${articleCount}</h2>
                    <p>
                        Fresh content loaded! This article appeared because you pulled the loading 
                        indicator far enough that TriggerSpring decided to fully reveal it and 
                        trigger the refresh callback.
                    </p>
                    <div class="meta">Just now</div>
                `
                content.insertBefore(newArticle, content.firstChild)

                // Reset state
                isRefreshing = false
                status.textContent = '‚úÖ Refreshed successfully!'
                status.style.color = '#28a745'
                loadingTrigger.classList.remove('active')
                loadingText.textContent = 'Pull down to refresh'

                // Scroll back to HIDE the loading trigger
                scrollContainer.scrollTo({
                    top: loadingTrigger.offsetHeight,
                    behavior: 'smooth'
                })

                setTimeout(() => {
                    status.textContent = 'Scroll to top and pull down'
                    status.style.color = '#333'
                }, 2500)
            }, 1500)
        }

        // Show visual feedback of pull percentage
        let statusUpdateTimeout
        scrollContainer.addEventListener('scroll', () => {
            if (isRefreshing) return

            clearTimeout(statusUpdateTimeout)

            const scrollTop = scrollContainer.scrollTop
            const triggerHeight = loadingTrigger.offsetHeight

            if (scrollTop < triggerHeight && scrollTop >= 0) {
                const percentVisible = Math.round(((triggerHeight - scrollTop) / triggerHeight) * 100)
                status.textContent = `Pulled ${percentVisible}% (release to snap)`
                status.style.color = '#ffc107'
            } else if (scrollTop >= triggerHeight) {
                statusUpdateTimeout = setTimeout(() => {
                    status.textContent = 'Scroll to top and pull down'
                    status.style.color = '#333'
                }, 300)
            }
        })

        // Update controls
        delaySlider.addEventListener('input', (e) => {
            delayValue.textContent = `${e.target.value}ms`
            initSpring()
        })

        offsetSlider.addEventListener('input', (e) => {
            offsetValue.textContent = `${e.target.value}px`
            initSpring()
        })

        directionSelect.addEventListener('change', () => {
            initSpring()
        })

        // Initialize
        initSpring()
    </script>
</body>
</html>